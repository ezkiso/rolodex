<!-- src/app/home/home.page.html -->

<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Rolodex
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Header con título cuando se hace scroll -->
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Rolodex</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Barra de búsqueda -->
  <div class="search-container">
    <ion-searchbar
      placeholder="Buscar contactos..."
      [(ngModel)]="searchTerm"
      (ionInput)="onSearchChange($event)"
      show-clear-button="focus">
    </ion-searchbar>
  </div>

  <!-- Lista de contactos -->
  <div class="contacts-container">
    <div *ngIf="filteredContacts.length === 0" class="no-contacts">
      <ion-icon name="person" size="large"></ion-icon>
      <p>No hay contactos que mostrar</p>
      <p class="subtitle">{{ searchTerm ? 'No se encontraron resultados' : 'Agrega tu primer contacto usando el botón +' }}</p>
    </div>

    <ion-card *ngFor="let contact of filteredContacts" class="contact-card">
      <ion-card-header>
        <div class="contact-header">
          <div class="contact-avatar">
            <span>{{ getInitials(contact.name) }}</span>
          </div>
          <div class="contact-info">
            <ion-card-title>{{ contact.name }}</ion-card-title>
            <ion-card-subtitle *ngIf="contact.position && contact.company">
              {{ contact.position }} en {{ contact.company }}
            </ion-card-subtitle>
            <ion-card-subtitle *ngIf="contact.company && !contact.position">
              {{ contact.company }}
            </ion-card-subtitle>
            <ion-card-subtitle *ngIf="contact.position && !contact.company">
              {{ contact.position }}
            </ion-card-subtitle>
            <app-social-links [links]="contact.links"></app-social-links>
          </div>
          <div class="contact-actions">
            <ion-chip [color]="getPriorityColor(contact.priority)" class="priority-chip">
              {{ getPriorityText(contact.priority) }}
            </ion-chip>
            <div class="action-buttons">
              <ion-button 
                fill="clear" 
                size="small" 
                color="medium"
                (click)="exportContactAsPDF(contact)"
                title="Exportar contacto como PDF">
                <ion-icon name="download"></ion-icon>
                PDF
              </ion-button>
              <ion-button 
                fill="clear" 
                size="small" 
                color="primary"
                (click)="editContact(contact)"
                title="Editar contacto">
                <ion-icon name="create"></ion-icon>
                Editar
              </ion-button>
              <ion-button 
                fill="clear" 
                size="small" 
                color="danger"
                (click)="deleteContact(contact)"
                title="Eliminar contacto">
                <ion-icon name="trash"></ion-icon>
                Eliminar
              </ion-button>
            </div>
          </div>
        </div>
      </ion-card-header>

      <ion-card-content>
        <div class="contact-link" *ngIf="contact.email">
          <ion-icon name="mail"></ion-icon>
          <ion-input
            [value]="contact.email"
            readonly
            type="email"
            style="user-select: text; background: transparent; border: none; padding: 0; font-size: inherit;">
          </ion-input>
        </div>
          <div class="contact-link" *ngIf="contact.phone">
            <ion-icon name="call"></ion-icon>
            <a [href]="'tel:' + contact.phone" style="color: var(--ion-color-primary); text-decoration: underline;">
              {{ contact.phone }}
            </a>
          </div>

        <!-- Tags -->
        <div class="tags-container" *ngIf="contact.tags.length > 0">
          <ion-chip *ngFor="let tag of contact.tags" color="primary" outline="true">
            {{ tag }}
          </ion-chip>
        </div>

        <!-- Información de fechas -->
        <div class="date-info">
          <small>
            Creado: {{ formatDate(contact.dateCreated) }} | 
            Última interacción: {{ formatDate(contact.lastInteraction) }}
          </small>
        </div>

        <!-- Notas resumidas -->
        <div class="notes-preview" *ngIf="contact.notes.length > 0">
          <p><strong>Última nota:</strong> {{ contact.notes[0].text | slice:0:100 }}
            <span *ngIf="contact.notes[0].text.length > 100">...</span>
          </p>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Botón flotante para agregar contacto -->
  <ion-fab slot="fixed" vertical="top" horizontal="end" class="fab-container">
    <ion-fab-button 
      [class.rotated]="showForm"
      (click)="toggleForm()"
      color="primary">
      <ion-icon [name]="showForm ? 'close' : 'add'"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <!-- Formulario flotante -->
  <div class="floating-form" [class.show]="showForm">
    <app-contact-form
      [contact]="selectedContact"
      [isVisible]="showForm"
      (formClosed)="onFormClosed()"
      (contactSaved)="onContactSaved($event)">
    </app-contact-form>
  </div>
</ion-content>